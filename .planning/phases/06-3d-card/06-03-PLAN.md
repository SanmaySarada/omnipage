---
phase: 06-3d-card
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - components/hero/hero-card-3d.tsx
autonomous: false

must_haves:
  truths:
    - "User sees 3D credit card with metallic materials in hero section"
    - "Card tilts smoothly following mouse cursor on desktop"
    - "Mobile users can enable gyroscope tilt via button tap"
    - "Card has holographic shimmer effect visible when rotating"
  artifacts:
    - path: "components/hero/hero-card-3d.tsx"
      provides: "Complete interactive 3D card in hero"
      exports: ["HeroCard3D"]
  key_links:
    - from: "components/hero/hero-card-3d.tsx"
      to: "components/three/card/card-interactive.tsx"
      via: "CardInteractive import"
      pattern: "import.*CardInteractive"
    - from: "components/hero/hero-card-3d.tsx"
      to: "components/three/card/use-device-orientation.ts"
      via: "useDeviceOrientation import"
      pattern: "import.*useDeviceOrientation"
    - from: "components/hero/hero-card-3d.tsx"
      to: "@react-three/drei"
      via: "Environment import"
      pattern: "import.*Environment.*drei"
---

<objective>
Integrate CardInteractive into HeroCard3D, add Environment for realistic reflections, and wire up the gyroscope permission button for mobile users.

Purpose: Complete the interactive 3D card experience - the card responds to cursor/device movement and looks premium with environment reflections.

Output: Fully functional interactive 3D card in hero section with cursor tracking, gyroscope support, and holographic shimmer.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-3d-card/06-RESEARCH.md

# Prior plan outputs
@.planning/phases/06-3d-card/06-01-SUMMARY.md
@.planning/phases/06-3d-card/06-02-SUMMARY.md

# File to modify
@components/hero/hero-card-3d.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update HeroCard3D with full integration</name>
  <files>components/hero/hero-card-3d.tsx</files>
  <action>
Replace the placeholder CardPlaceholder with the full interactive card:

1. **Remove CardPlaceholder function** - No longer needed

2. **Add imports:**
   - Environment from @react-three/drei (already has View, add Environment)
   - CardInteractive from @/components/three/card/card-interactive
   - useDeviceOrientation from @/components/three/card/use-device-orientation

3. **Add hook call in HeroCard3D:**
   ```typescript
   const { orientation, permission, requestPermission, isSupported } = useDeviceOrientation()
   const gyroscopeEnabled = permission === 'granted'
   ```

4. **Add mobile permission button (conditional):**
   - Only show when isSupported AND permission === 'prompt'
   - Position: absolute top-2 right-2 z-10
   - Style: text-xs, subtle background (bg-primary/10 or similar)
   - Text: "Enable tilt" or similar
   - onClick: requestPermission
   - This satisfies iOS requirement for user gesture before permission request

5. **Update View children:**
   - Keep ambientLight but reduce intensity to 0.3 (Environment provides more light)
   - Keep directionalLight at position [5, 5, 5] but reduce intensity to 0.8
   - Add Environment preset="city" for reflections
     - NOTE: Environment works in View because drei handles the scene context
   - Replace CardPlaceholder with CardInteractive:
     ```typescript
     <CardInteractive
       gyroscopeEnabled={gyroscopeEnabled}
       gyroscopeData={orientation}
     />
     ```

6. **Keep existing structure:**
   - Keep LoadingFallback
   - Keep View className and sizing
   - Keep Suspense wrapper

IMPORTANT: The Environment component is needed for MeshPhysicalMaterial's iridescence and metalness to look correct - without it, reflections have nothing to reflect.
  </action>
  <verify>
File modified at components/hero/hero-card-3d.tsx.
CardPlaceholder function is removed.
Imports CardInteractive and useDeviceOrientation.
Imports Environment from drei.
Contains Environment preset="city" inside View.
Has conditional button for gyroscope permission.
Run `npm run build` - should succeed.
Run `npm run dev` - card should be visible in hero.
  </verify>
  <done>HeroCard3D renders CardInteractive with Environment and gyroscope permission button</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Interactive 3D credit card with premium metallic materials, cursor-tracking rotation, and mobile gyroscope support</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:3000 in browser

**Desktop verification:**
3. Look at hero section - card should be visible with dark metallic appearance
4. Move mouse around the card area - card should tilt/rotate to follow cursor smoothly
5. Notice the holographic shimmer effect as card rotates (color shifts on surface)
6. Movement should feel smooth, not jerky (60fps)

**Mobile verification (if available):**
7. Open on iPhone/iPad or use Chrome DevTools mobile emulation with gyroscope
8. Look for "Enable tilt" button in top-right of card area
9. Tap button to grant gyroscope permission
10. Tilt device - card should respond to physical tilt

**What to look for:**
- Card has glossy metallic appearance (not flat/matte)
- Holographic rainbow shimmer visible when rotating
- Rotation is smooth and follows input naturally
- Card tilts maximum ~14 degrees (not extreme)
- No visual glitches or flickering
  </how-to-verify>
  <resume-signal>Type "approved" if card looks premium and interactions work, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npm run dev` shows interactive card in hero
3. Card responds to mouse movement on desktop
4. Holographic shimmer visible during rotation
5. Mobile gyroscope button appears on touch devices
6. Performance is smooth (no jank during interaction)
</verification>

<success_criteria>
- HeroCard3D renders CardInteractive instead of placeholder
- Environment preset provides reflections for metallic material
- Card rotates smoothly following cursor with dampE easing
- Mobile users see "Enable tilt" button and can enable gyroscope
- Holographic iridescence effect visible on card surface
- Interaction maintains 60fps (no setState in useFrame)
</success_criteria>

<output>
After completion, create `.planning/phases/06-3d-card/06-03-SUMMARY.md`
</output>
