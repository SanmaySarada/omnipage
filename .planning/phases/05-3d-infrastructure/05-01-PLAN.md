---
phase: 05-3d-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - next.config.ts
autonomous: true

must_haves:
  truths:
    - "@react-three/fiber v9+ is installed"
    - "@react-three/drei v10+ is installed"
    - "three is installed as peer dependency"
    - "Next.js transpiles three package correctly"
  artifacts:
    - path: "package.json"
      provides: "R3F dependencies"
      contains: "@react-three/fiber"
    - path: "next.config.ts"
      provides: "Three.js transpilation config"
      contains: "transpilePackages"
  key_links:
    - from: "package.json"
      to: "next.config.ts"
      via: "three package needs transpilation"
      pattern: "transpilePackages.*three"
---

<objective>
Install React Three Fiber v9 ecosystem and configure Next.js for Three.js

Purpose: Establish the package foundation for 3D rendering with React 19 compatibility
Output: R3F v9, drei v10, three installed; Next.js configured to transpile three
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-3d-infrastructure/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install R3F v9 ecosystem</name>
  <files>package.json</files>
  <action>
Run npm install to add React Three Fiber v9 ecosystem:

```bash
npm install @react-three/fiber@^9 @react-three/drei@^10 three
```

IMPORTANT version requirements (from research):
- @react-three/fiber must be v9+ for React 19 compatibility
- @react-three/drei must be v10+ for R3F v9 compatibility
- three is the peer dependency (current stable ~0.170)

Do NOT install older versions - they will cause "Cannot read properties of undefined (reading 'ReactCurrentOwner')" errors with React 19.
  </action>
  <verify>
Run `npm ls @react-three/fiber @react-three/drei three` and confirm:
- @react-three/fiber is ^9.x
- @react-three/drei is ^10.x
- three is installed
  </verify>
  <done>R3F v9, drei v10, and three are in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Configure Next.js for Three.js transpilation</name>
  <files>next.config.ts</files>
  <action>
Update next.config.ts to transpile the three package:

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  transpilePackages: ['three'],
};

export default nextConfig;
```

WHY: Three.js uses ES modules that need transpilation for Next.js bundling. Without this, you'll get module resolution errors at build time.

Do NOT add @react-three/fiber or @react-three/drei to transpilePackages - only three needs it.
  </action>
  <verify>
Run `npm run build` and confirm no module resolution errors related to three.js
  </verify>
  <done>Next.js config includes transpilePackages: ['three']</done>
</task>

</tasks>

<verification>
1. `npm ls @react-three/fiber` shows ^9.x
2. `npm ls @react-three/drei` shows ^10.x
3. `npm run build` completes without three.js related errors
4. No peer dependency warnings for React version mismatch
</verification>

<success_criteria>
- R3F ecosystem installed at React 19-compatible versions
- Next.js configured to transpile three
- Build succeeds without module errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-3d-infrastructure/05-01-SUMMARY.md`
</output>
