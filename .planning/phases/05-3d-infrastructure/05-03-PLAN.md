---
phase: 05-3d-infrastructure
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - components/three/loading-fallback.tsx
  - components/hero/hero-card-3d.tsx
  - components/hero/hero-section.tsx
autonomous: true

must_haves:
  truths:
    - "Placeholder skeleton shows while 3D loads"
    - "3D placeholder renders in hero without blocking above-fold content"
    - "View component is positioned in hero section"
    - "Loading state is visible during asset loading"
  artifacts:
    - path: "components/three/loading-fallback.tsx"
      provides: "Loading skeleton for 3D content"
      exports: ["LoadingFallback"]
    - path: "components/hero/hero-card-3d.tsx"
      provides: "3D card placeholder with View"
      exports: ["HeroCard3D"]
      contains: "View"
    - path: "components/hero/hero-section.tsx"
      provides: "Hero with 3D placeholder integrated"
      contains: "HeroCard3D"
  key_links:
    - from: "components/hero/hero-section.tsx"
      to: "components/hero/hero-card-3d.tsx"
      via: "HeroCard3D import and render"
      pattern: "import.*HeroCard3D"
    - from: "components/hero/hero-card-3d.tsx"
      to: "@react-three/drei"
      via: "View component for viewport"
      pattern: "import.*View.*@react-three/drei"
    - from: "components/hero/hero-card-3d.tsx"
      to: "components/three/loading-fallback.tsx"
      via: "LoadingFallback while 3D loads"
      pattern: "LoadingFallback"
---

<objective>
Create placeholder components and integrate 3D viewport into hero section

Purpose: Show loading state and placeholder 3D content while assets load, verify View pattern works
Output: Loading skeleton, 3D placeholder card, hero section with 3D viewport
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-3d-infrastructure/05-RESEARCH.md
@components/hero/hero-section.tsx
@components/hero/hero-content.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create loading fallback skeleton</name>
  <files>components/three/loading-fallback.tsx</files>
  <action>
Create `components/three/loading-fallback.tsx` with DOM-based loading skeleton:

```typescript
'use client'

import { useProgress } from '@react-three/drei'

export function LoadingFallback() {
  const { active, progress } = useProgress()

  if (!active) return null

  return (
    <div className="absolute inset-0 flex items-center justify-center">
      <div className="flex flex-col items-center gap-2">
        <div className="w-48 h-1 bg-muted rounded-full overflow-hidden">
          <div
            className="h-full bg-primary transition-all duration-300 ease-out"
            style={{ width: `${progress}%` }}
          />
        </div>
        <span className="text-xs text-muted-foreground">
          Loading 3D...
        </span>
      </div>
    </div>
  )
}
```

This shows a progress bar while 3D assets load. useProgress from drei hooks into THREE.DefaultLoadingManager to track loading state.

The component returns null when not loading, so it doesn't affect layout after load completes.
  </action>
  <verify>
File exists at components/three/loading-fallback.tsx with:
- 'use client' directive
- useProgress hook from drei
- Progress bar UI with Tailwind classes
  </verify>
  <done>LoadingFallback component shows progress while 3D assets load</done>
</task>

<task type="auto">
  <name>Task 2: Create 3D card placeholder with View</name>
  <files>components/hero/hero-card-3d.tsx</files>
  <action>
Create `components/hero/hero-card-3d.tsx` with a View-based 3D placeholder:

```typescript
'use client'

import { View } from '@react-three/drei'
import { Suspense } from 'react'
import { LoadingFallback } from '@/components/three/loading-fallback'

// Placeholder mesh - will be replaced with actual card model in Phase 6
function CardPlaceholder() {
  return (
    <mesh rotation={[0, 0.2, 0]}>
      {/* Credit card aspect ratio: 85.6mm x 53.98mm = ~1.586:1 */}
      <boxGeometry args={[3.375, 2.125, 0.05]} />
      <meshStandardMaterial
        color="#8b5cf6"
        metalness={0.5}
        roughness={0.3}
      />
    </mesh>
  )
}

export function HeroCard3D() {
  return (
    <div className="relative w-full max-w-md mx-auto aspect-[4/3]">
      <LoadingFallback />
      <View className="absolute inset-0 pointer-events-auto">
        <Suspense fallback={null}>
          <ambientLight intensity={0.5} />
          <directionalLight position={[5, 5, 5]} intensity={1} />
          <CardPlaceholder />
        </Suspense>
      </View>
    </div>
  )
}
```

IMPORTANT View pattern (from research):
- View creates a viewport that renders into the single Canvas via View.Port
- pointer-events-auto re-enables mouse interaction for this viewport
- Suspense boundary prevents blocking - shows nothing while mesh loads

The CardPlaceholder is a simple box with credit card proportions (3.375:2.125 = standard card ratio). This will be replaced with the actual 3D card model in Phase 6.

The wrapper div has aspect-[4/3] to maintain consistent space for the 3D content.
  </action>
  <verify>
File exists at components/hero/hero-card-3d.tsx with:
- 'use client' directive
- View component from drei
- Suspense boundary
- CardPlaceholder mesh with credit card proportions
- LoadingFallback integration
  </verify>
  <done>HeroCard3D renders a placeholder 3D card via View component</done>
</task>

<task type="auto">
  <name>Task 3: Integrate 3D placeholder into hero section</name>
  <files>components/hero/hero-section.tsx</files>
  <action>
Update `components/hero/hero-section.tsx` to include the 3D card placeholder:

```typescript
import { HeroContent } from './hero-content'
import { MetricCards } from './metric-cards'
import { HeroCard3D } from './hero-card-3d'

export function HeroSection() {
  return (
    <section className="relative min-h-screen flex flex-col justify-center py-20">
      {/* Gradient mesh background */}
      <div className="hero-gradient" aria-hidden="true" />

      <div className="container relative z-10">
        <div className="grid lg:grid-cols-2 gap-12 items-center">
          <HeroContent />

          {/* 3D Card - positioned to right on desktop, below on mobile */}
          <div className="order-first lg:order-last">
            <HeroCard3D />
          </div>
        </div>

        <div className="mt-16 sm:mt-20">
          <MetricCards />
        </div>
      </div>
    </section>
  )
}
```

Changes from original:
- Added HeroCard3D import
- Wrapped HeroContent and HeroCard3D in 2-column grid
- Card appears first on mobile (order-first), last on desktop (lg:order-last)
- Added gap-12 for spacing between columns

This creates a split layout: text/CTA on left, 3D card on right (desktop). On mobile, the card appears above the text for visual impact.
  </action>
  <verify>
1. `npm run dev` and visit http://localhost:3000
2. 3D purple card placeholder is visible in hero section
3. On desktop (>1024px): card on right, text on left
4. On mobile: card above text
5. No console errors
  </verify>
  <done>Hero section displays 3D placeholder in grid layout with responsive ordering</done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. Visit http://localhost:3000 - 3D card placeholder visible in hero
3. Card renders as purple metallic box with credit card proportions
4. Loading progress bar appears briefly during initial load
5. Layout is 2-column on desktop, stacked on mobile
6. No console errors related to WebGL, hydration, or View
7. Resize browser - layout responds correctly
</verification>

<success_criteria>
- LoadingFallback shows progress during 3D asset loading
- HeroCard3D renders placeholder card via View component
- Hero section displays card in responsive 2-column layout
- 3D content loads asynchronously without blocking above-fold render
- All Phase 5 success criteria met (Canvas + View.Port, async loading, placeholder, iOS handling)
</success_criteria>

<output>
After completion, create `.planning/phases/05-3d-infrastructure/05-03-SUMMARY.md`
</output>
