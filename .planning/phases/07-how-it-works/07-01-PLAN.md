---
phase: 07-how-it-works
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/how-it-works/how-it-works-section.tsx
  - components/how-it-works/how-it-works-static.tsx
  - app/page.tsx
autonomous: true

must_haves:
  truths:
    - "User with prefers-reduced-motion sees static step cards"
    - "Section has 175vh height for scroll distance"
    - "Sticky viewport pins during scroll"
  artifacts:
    - path: "components/how-it-works/how-it-works-section.tsx"
      provides: "Main section wrapper with useScroll tracking"
      exports: ["HowItWorksSection"]
    - path: "components/how-it-works/how-it-works-static.tsx"
      provides: "Static fallback for reduced motion"
      exports: ["HowItWorksStatic"]
  key_links:
    - from: "components/how-it-works/how-it-works-section.tsx"
      to: "useReducedMotion"
      via: "conditional render"
      pattern: "useReducedMotion.*HowItWorksStatic"
    - from: "app/page.tsx"
      to: "HowItWorksSection"
      via: "import and render"
      pattern: "import.*HowItWorksSection"
---

<objective>
Create the How It Works section infrastructure with scroll tracking and reduced motion fallback.

Purpose: Establish the tall container + sticky viewport pattern that enables scroll-linked animation, while ensuring accessibility via static fallback for users with prefers-reduced-motion.

Output: Working section that pins during scroll (or shows static cards for reduced motion), integrated into page.tsx.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-how-it-works/07-RESEARCH.md

@components/providers.tsx (MotionConfig reducedMotion="user" already configured)
@lib/animation-variants.ts (existing animation infrastructure)
@app/page.tsx (current page with placeholder sections)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create HowItWorksStatic component</name>
  <files>components/how-it-works/how-it-works-static.tsx</files>
  <action>
Create static step cards fallback component for users with prefers-reduced-motion.

Structure:
- 'use client' directive (uses motion for simple fade-in)
- Import motion from 'motion/react', lucide icons (CreditCard, ArrowRight, Wallet, Building2)
- Define steps array with 3 steps:
  1. "Swipe Your Card" - Use your Omni card anywhere Visa is accepted
  2. "Payment Routes Automatically" - Transaction flows through our secure network
  3. "Everyone Wins" - School receives ACH payment, you earn rewards
- Render as standard section (not tall container):
  - py-24 px-4 background
  - Centered heading "How It Works"
  - Grid of 3 cards (md:grid-cols-3, gap-8)
  - Each card: number badge, icon, title, description
  - Use motion.div with whileInView for simple opacity fade (viewport: { once: true })

Do NOT use useReducedMotion here - the parent component handles that check.
  </action>
  <verify>File exists, exports HowItWorksStatic, TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Static step cards component ready for reduced motion users</done>
</task>

<task type="auto">
  <name>Task 2: Create HowItWorksSection wrapper</name>
  <files>components/how-it-works/how-it-works-section.tsx</files>
  <action>
Create the main section wrapper with scroll tracking infrastructure.

Structure:
- 'use client' directive
- Imports: useRef from react, useScroll, useReducedMotion from 'motion/react'
- Import HowItWorksStatic from './how-it-works-static'

Component logic:
1. Call useReducedMotion() hook
2. Create containerRef with useRef<HTMLDivElement>(null)
3. Call useScroll with:
   - target: containerRef
   - offset: ["start start", "end end"]
4. Early return HowItWorksStatic if prefersReducedMotion is true

JSX structure (for animated version):
- section with ref={containerRef}, id="how-it-works", className="relative h-[175vh]"
- Inside: sticky viewport div with className="sticky top-0 h-screen overflow-hidden flex items-center justify-center"
- For now, render placeholder content: "Animation content coming in Plan 02"
- Pass scrollYProgress to future child components (comment showing where PaymentFlowAnimation will go)

Export HowItWorksSection as named export.
  </action>
  <verify>File exists, exports HowItWorksSection, TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Section wrapper with useScroll tracking and reduced motion conditional rendering</done>
</task>

<task type="auto">
  <name>Task 3: Integrate into page.tsx</name>
  <files>app/page.tsx</files>
  <action>
Replace the How It Works placeholder section with the new component.

Changes:
1. Add import: `import { HowItWorksSection } from '@/components/how-it-works/how-it-works-section'`
2. Replace the existing placeholder section (lines 50-56 with id="how-it-works") with: `<HowItWorksSection />`
3. Keep other placeholder sections (features, calculator, faq) as-is
4. Remove the Animation Infrastructure Demo section (lines 9-48) - it was only for Phase 4 verification

The page should now have:
- HeroSection
- HowItWorksSection (new)
- Features placeholder
- Calculator placeholder
- FAQ placeholder
  </action>
  <verify>
Run `npm run build` to verify no errors.
Visual check: Section pins during scroll, shows static cards if reduced motion enabled.
  </verify>
  <done>How It Works section integrated, replaces placeholder, demo section removed</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - TypeScript compiles without errors
2. `npm run build` - Build succeeds
3. Scroll behavior: Section is 175vh tall, viewport pins at top during scroll
4. Reduced motion: Enable "Reduce motion" in OS settings, refresh page, see static cards instead of tall section
5. Navigation: Clicking "How It Works" in nav scrolls to section (existing smooth scroll)
</verification>

<success_criteria>
- HowItWorksSection renders with 175vh height
- Sticky viewport pins during scroll through section
- Users with prefers-reduced-motion see static step cards
- Page builds without errors
- Section is accessible via nav link
</success_criteria>

<output>
After completion, create `.planning/phases/07-how-it-works/07-01-SUMMARY.md`
</output>
