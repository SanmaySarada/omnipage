---
phase: 07-how-it-works
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - components/how-it-works/progress-dots.tsx
  - components/how-it-works/how-it-works-section.tsx
autonomous: true

must_haves:
  truths:
    - "User sees progress dots indicating current scroll position"
    - "User can click dots to jump to specific steps"
    - "Dots are hidden on mobile (md: and up only)"
  artifacts:
    - path: "components/how-it-works/progress-dots.tsx"
      provides: "Clickable navigation dots with scroll-to functionality"
      exports: ["ProgressDots"]
  key_links:
    - from: "components/how-it-works/progress-dots.tsx"
      to: "window.scrollTo"
      via: "click handler"
      pattern: "scrollTo.*behavior.*smooth"
    - from: "components/how-it-works/how-it-works-section.tsx"
      to: "ProgressDots"
      via: "renders with progress and containerRef"
      pattern: "ProgressDots.*progress.*containerRef"
---

<objective>
Create clickable progress dots for step navigation within the How It Works section.

Purpose: Give users a visual indicator of their progress through the section and allow them to jump directly to specific steps without scrolling.

Output: Fixed-position navigation dots that update based on scroll position and respond to clicks.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-how-it-works/07-RESEARCH.md

@components/how-it-works/how-it-works-section.tsx (from Plan 01 - has containerRef and scrollYProgress)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProgressDots component</name>
  <files>components/how-it-works/progress-dots.tsx</files>
  <action>
Create the clickable progress dots navigation component.

Structure:
- 'use client' directive
- Imports: motion, useTransform, MotionValue from 'motion/react'
- Import RefObject from 'react'

Props interface:
```typescript
interface ProgressDotsProps {
  progress: MotionValue<number>
  containerRef: RefObject<HTMLElement | null>
}
```

Define steps array (matches animation phases):
```typescript
const steps = [
  { label: 'Swipe Card', position: 0.15 },
  { label: 'Process', position: 0.5 },
  { label: 'Split Funds', position: 0.85 },
] as const
```

scrollToStep function:
```typescript
const scrollToStep = (stepPosition: number) => {
  if (!containerRef.current) return

  const container = containerRef.current
  const scrollableDistance = container.scrollHeight - window.innerHeight
  const targetScrollTop = container.offsetTop + (scrollableDistance * stepPosition)

  window.scrollTo({
    top: targetScrollTop,
    behavior: 'smooth'
  })
}
```

ProgressDot sub-component:
- Takes step, progress, onClick props
- Use useTransform to determine active state:
  - scale: [position - 0.15, position, position + 0.15] -> [1, 1.5, 1]
  - opacity: [position - 0.15, position, position + 0.15] -> [0.4, 1, 0.4]
- Render button with:
  - aria-label={`Go to ${step.label}`}
  - onClick handler
  - group class for hover label reveal
  - motion.div for the dot (w-3 h-3 rounded-full bg-primary)
  - span for label (hidden by default, shows on hover: opacity-0 group-hover:opacity-100)

Main component JSX:
```jsx
<nav
  className="hidden md:flex fixed right-6 top-1/2 -translate-y-1/2 flex-col gap-4 z-50"
  aria-label="How it works steps"
>
  {steps.map((step) => (
    <ProgressDot
      key={step.label}
      step={step}
      progress={progress}
      onClick={() => scrollToStep(step.position)}
    />
  ))}
</nav>
```

Accessibility requirements:
- Minimum 44x44px touch target (use p-4 around visual dot)
- Clear aria-labels
- Focus visible states (focus-visible:ring-2 focus-visible:ring-primary)
- touch-action: manipulation to prevent double-tap zoom delay
  </action>
  <verify>File exists, exports ProgressDots, TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>Progress dots with scroll-to navigation functionality</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ProgressDots into section</name>
  <files>components/how-it-works/how-it-works-section.tsx</files>
  <action>
Add ProgressDots component to HowItWorksSection.

Changes:
1. Add import: `import { ProgressDots } from './progress-dots'`
2. Add ProgressDots INSIDE the section but OUTSIDE the sticky viewport:
   - Must be inside section so it only shows when section is in view
   - Outside sticky so it doesn't scroll with content

Updated structure:
```jsx
<section
  ref={containerRef}
  id="how-it-works"
  className="relative h-[175vh]"
>
  {/* Progress navigation - only shows when section visible */}
  <ProgressDots progress={scrollYProgress} containerRef={containerRef} />

  {/* Sticky animation viewport */}
  <div className="sticky top-0 h-screen overflow-hidden bg-gradient-to-b from-background via-muted/30 to-background">
    <PaymentFlowAnimation progress={scrollYProgress} />
  </div>
</section>
```

NOTE: ProgressDots uses fixed positioning internally, so placing inside section scope limits when it appears. The dots will only be visible while scrolling through this section.

Actually, reconsider: For dots to only show during this section, we need to control their visibility based on scroll position. Add visibility logic to ProgressDots:

In ProgressDots, add visibility transform:
```typescript
// Show dots only when section is in viewport
const dotsOpacity = useTransform(
  progress,
  [0, 0.02, 0.98, 1],
  [0, 1, 1, 0]
)
```

Wrap nav in motion.nav with style={{ opacity: dotsOpacity }}.
  </action>
  <verify>
`npm run build` succeeds.
Visual check:
- Dots appear on right when scrolling through How It Works section
- Dots disappear when section scrolls out
- Clicking dots jumps to correct animation phase
- Dots hidden on mobile (test at < 768px width)
  </verify>
  <done>Progress dots integrated with visibility control</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - TypeScript compiles
2. `npm run build` - Build succeeds
3. Desktop (md+):
   - Dots visible on right side during How It Works section
   - Active dot scales up based on scroll position
   - Hovering dot shows step label
   - Clicking dot smoothly scrolls to that step
   - Dots fade out when leaving section
4. Mobile (<768px):
   - Dots are hidden (hidden md:flex class)
5. Accessibility:
   - Tab focuses dots in order
   - Focus ring visible on focus
   - Screen reader announces "Go to [step name]"
</verification>

<success_criteria>
- Progress dots visible during section scroll (desktop only)
- Active dot visually highlighted based on scroll position
- Click navigation jumps to correct scroll position
- Smooth scroll animation when clicking dots
- Dots hidden on mobile viewports
- Keyboard accessible with visible focus states
</success_criteria>

<output>
After completion, create `.planning/phases/07-how-it-works/07-03-SUMMARY.md`
</output>
