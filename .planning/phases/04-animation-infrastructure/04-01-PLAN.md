---
phase: 04-animation-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/animation-variants.ts
  - components/ui/scroll-reveal.tsx
  - app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Elements animate into view when scrolled into viewport"
    - "Animations only play once (no replay on scroll back)"
    - "Users with prefers-reduced-motion see static content without transform animations"
    - "Animations maintain 60fps on scroll (no visible jank)"
  artifacts:
    - path: "lib/animation-variants.ts"
      provides: "Centralized scroll reveal variants and transition presets"
      contains: "fadeInVariants, slideUpVariants, staggerContainerVariants"
    - path: "components/ui/scroll-reveal.tsx"
      provides: "Reusable scroll reveal wrapper component"
      exports: ["ScrollReveal"]
  key_links:
    - from: "components/ui/scroll-reveal.tsx"
      to: "lib/animation-variants.ts"
      via: "import transition presets"
      pattern: "from.*animation-variants"
    - from: "components/ui/scroll-reveal.tsx"
      to: "motion/react"
      via: "whileInView prop"
      pattern: "whileInView"
---

<objective>
Create reusable scroll-triggered animation infrastructure

Purpose: Provide consistent, performant, accessible scroll animations for all content sections (Features, FAQ, How It Works, etc.)

Output:
- Extended `lib/animation-variants.ts` with scroll reveal variants
- `components/ui/scroll-reveal.tsx` wrapper component
- Verified 60fps performance and reduced motion support
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-animation-infrastructure/04-RESEARCH.md

@lib/animation-variants.ts
@components/providers.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend animation-variants.ts with scroll reveal variants</name>
  <files>lib/animation-variants.ts</files>
  <action>
Add scroll reveal variants and presets to the existing animation-variants.ts file. Keep all existing variants (navVariants, heroContainerVariants, etc.) and add new exports below them.

Add these scroll reveal variants with TypeScript types:

```typescript
import type { Variants, Transition } from 'motion/react'

// === SCROLL REVEAL VARIANTS ===

export const fadeInVariants: Variants = {
  hidden: { opacity: 0 },
  visible: { opacity: 1 },
}

export const slideUpVariants: Variants = {
  hidden: { opacity: 0, y: 30 },
  visible: { opacity: 1, y: 0 },
}

export const slideDownVariants: Variants = {
  hidden: { opacity: 0, y: -30 },
  visible: { opacity: 1, y: 0 },
}

export const slideLeftVariants: Variants = {
  hidden: { opacity: 0, x: 30 },
  visible: { opacity: 1, x: 0 },
}

export const slideRightVariants: Variants = {
  hidden: { opacity: 0, x: -30 },
  visible: { opacity: 1, x: 0 },
}

export const scaleInVariants: Variants = {
  hidden: { opacity: 0, scale: 0.95 },
  visible: { opacity: 1, scale: 1 },
}

// Stagger container (for grids/lists)
export const staggerContainerVariants: Variants = {
  hidden: { opacity: 1 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1,
      delayChildren: 0.1,
    },
  },
}

// === TRANSITION PRESETS ===

export const defaultRevealTransition: Transition = {
  duration: 0.5,
  ease: 'easeOut',
}

export const quickRevealTransition: Transition = {
  duration: 0.3,
  ease: 'easeOut',
}

export const springRevealTransition: Transition = {
  type: 'spring',
  stiffness: 100,
  damping: 15,
}

// === VIEWPORT PRESETS ===

export const defaultViewport = {
  once: true,
  amount: 0.3 as const,
}

export const fullViewport = {
  once: true,
  amount: 'all' as const,
}
```

Only animate transform and opacity properties (GPU-accelerated). Use 30px offsets for slide variants (subtle but visible).
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit lib/animation-variants.ts`
All exports are accessible: grep for each variant name in file
  </verify>
  <done>
animation-variants.ts exports fadeInVariants, slideUpVariants, slideDownVariants, slideLeftVariants, slideRightVariants, scaleInVariants, staggerContainerVariants, defaultRevealTransition, quickRevealTransition, springRevealTransition, defaultViewport, fullViewport
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ScrollReveal wrapper component</name>
  <files>components/ui/scroll-reveal.tsx</files>
  <action>
Create a reusable ScrollReveal wrapper component that uses motion's whileInView for scroll-triggered animations.

```typescript
'use client'

import { motion, Variants } from 'motion/react'
import { ReactNode } from 'react'
import { defaultRevealTransition, defaultViewport } from '@/lib/animation-variants'

type Direction = 'up' | 'down' | 'left' | 'right' | 'none'

interface ScrollRevealProps {
  children: ReactNode
  className?: string
  direction?: Direction
  delay?: number
  duration?: number
  once?: boolean
  amount?: 'some' | 'all' | number
  as?: keyof JSX.IntrinsicElements
}

const directionOffsets: Record<Direction, { x: number; y: number }> = {
  up: { x: 0, y: 30 },
  down: { x: 0, y: -30 },
  left: { x: 30, y: 0 },
  right: { x: -30, y: 0 },
  none: { x: 0, y: 0 },
}

export function ScrollReveal({
  children,
  className,
  direction = 'up',
  delay = 0,
  duration = defaultRevealTransition.duration as number,
  once = defaultViewport.once,
  amount = defaultViewport.amount,
  as = 'div',
}: ScrollRevealProps) {
  const offset = directionOffsets[direction]

  const variants: Variants = {
    hidden: {
      opacity: 0,
      x: offset.x,
      y: offset.y,
    },
    visible: {
      opacity: 1,
      x: 0,
      y: 0,
      transition: {
        duration,
        delay,
        ease: 'easeOut',
      },
    },
  }

  const MotionComponent = motion[as as keyof typeof motion] as typeof motion.div

  return (
    <MotionComponent
      variants={variants}
      initial="hidden"
      whileInView="visible"
      viewport={{ once, amount }}
      className={className}
    >
      {children}
    </MotionComponent>
  )
}
```

Key implementation details:
- Direction prop controls slide direction (up/down/left/right/none for fade-only)
- Uses whileInView for Intersection Observer-based triggering
- viewport.once = true prevents replay on scroll
- amount = 0.3 (30% visible) matches project defaults
- Supports className passthrough for Tailwind styling
- Uses 'as' prop for semantic HTML (section, article, etc.)
- MotionConfig reducedMotion="user" (already in Providers) auto-disables transform animations
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit components/ui/scroll-reveal.tsx`
Component exports correctly: grep for "export function ScrollReveal"
  </verify>
  <done>
ScrollReveal component exists at components/ui/scroll-reveal.tsx with direction, delay, duration, once, amount, and as props
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify animation infrastructure with demo and performance check</name>
  <files>app/page.tsx</files>
  <action>
Add a temporary demo section below the hero to verify scroll animations work. This will be replaced by real content sections in later phases.

Add import at top:
```typescript
import { ScrollReveal } from '@/components/ui/scroll-reveal'
```

Add demo section after HeroSection (before closing main tag):
```typescript
{/* Animation Infrastructure Demo - Remove after Phase 4 verification */}
<section className="py-24 bg-background">
  <div className="container mx-auto px-4">
    <ScrollReveal className="text-center mb-12">
      <h2 className="text-3xl font-bold">Scroll Animation Demo</h2>
      <p className="text-muted-foreground mt-2">
        This section verifies the animation infrastructure works correctly.
      </p>
    </ScrollReveal>

    <div className="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto">
      <ScrollReveal direction="up" delay={0}>
        <div className="p-6 rounded-xl bg-surface border border-border">
          <h3 className="font-semibold mb-2">Slide Up</h3>
          <p className="text-sm text-muted-foreground">Default animation direction</p>
        </div>
      </ScrollReveal>

      <ScrollReveal direction="up" delay={0.1}>
        <div className="p-6 rounded-xl bg-surface border border-border">
          <h3 className="font-semibold mb-2">Staggered</h3>
          <p className="text-sm text-muted-foreground">0.1s delay for stagger effect</p>
        </div>
      </ScrollReveal>

      <ScrollReveal direction="up" delay={0.2}>
        <div className="p-6 rounded-xl bg-surface border border-border">
          <h3 className="font-semibold mb-2">Third Card</h3>
          <p className="text-sm text-muted-foreground">0.2s delay completes sequence</p>
        </div>
      </ScrollReveal>
    </div>

    <ScrollReveal direction="left" delay={0.3} className="mt-12 text-center">
      <p className="text-sm text-muted-foreground">
        This text slides in from the right (direction="left" means content starts offset right)
      </p>
    </ScrollReveal>
  </div>
</section>
```

Verification steps:
1. Run dev server: `npm run dev`
2. Open http://localhost:3000
3. Scroll down past the hero - demo cards should animate in with stagger
4. Scroll back up and down - animations should NOT replay (once: true)
5. Enable "Reduce motion" in OS accessibility settings
6. Refresh page and scroll - transform animations should be disabled, only opacity
7. Open DevTools Performance tab, record while scrolling - should see 60fps (no long frames)
  </action>
  <verify>
Run `npm run dev` and verify:
- Demo section renders below hero
- Cards animate on scroll into view
- Animations do not replay on scroll back
- Console shows no errors
- Reduced motion: enable OS setting, refresh, verify no sliding (only fade)
  </verify>
  <done>
- Demo section visible at /
- ScrollReveal triggers animations on scroll
- Animations play once only
- Reduced motion respected (test with OS setting)
- No jank on scroll (60fps)
  </done>
</task>

</tasks>

<verification>
Run full verification sequence:

1. TypeScript check: `npx tsc --noEmit`
2. Dev server: `npm run dev`
3. Manual scroll test: Demo cards animate in with stagger
4. Replay test: Scroll up/down - animations don't replay
5. Reduced motion test:
   - macOS: System Settings > Accessibility > Display > Reduce motion
   - Refresh page, scroll - cards should fade but not slide
6. Performance test: DevTools > Performance > Record while scrolling
   - Frame rate should stay near 60fps
   - No long tasks (yellow bars) during scroll
</verification>

<success_criteria>
- [ ] animation-variants.ts exports 7 new variants + 3 transitions + 2 viewport presets
- [ ] ScrollReveal component exists with direction/delay/duration/once/amount props
- [ ] Demo section animates cards on scroll
- [ ] Animations play once (no replay)
- [ ] Reduced motion setting disables transform animations
- [ ] 60fps maintained during scroll (no visible jank)
</success_criteria>

<output>
After completion, create `.planning/phases/04-animation-infrastructure/04-01-SUMMARY.md`

Record:
- Final variants added to animation-variants.ts
- ScrollReveal API (props and usage patterns)
- Reduced motion behavior verified
- Performance observations
- Note: Demo section should be removed when Phase 8 (Content Sections) is implemented
</output>
